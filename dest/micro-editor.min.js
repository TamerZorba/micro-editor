var microEditor=function(b){"use strict";var c=this;return this.options={el:"editor",toolbar:"undo redo bold italic underline strikeThrough justifyLeft justifyCenter justifyRight justifyFull blockquote indent outdent insertUnorderedList insertOrderedList createlink unlink insertimage subscript superscript removeFormat print",debugMode:!1,pasteAsPlain:!1,preventPaste:!1,expandable:!1,showOnFocus:!1,position:"top",height:100,debounce:10,init:null,extended:{}},this["extends"]=function(a,b){for(var c in b)a[c]=b[c],this.options.extended[c]=!0;return a},b instanceof Object&&(this["extends"](this.options,b),b=this.options.el),b instanceof Element?this.el=b:this.el=document.getElementById(b),this.el||console.error("No Element called "+id),window.microEditorObject||(window.microEditorObject={},window.microEditorObject.counter=0),window.microEditorObject.counter++,this.idx=window.microEditorObject.counter,this.init=function(){if(!this.el.microEditor){this.el.microEditor=this,this.prepare(),this.create.editor(),this.editor.render(),this.options.init&&this.options.init.call(this);for(var a in microEditor.plugins.init)microEditor.plugins.init[a].call(this);this.editor.innerHTML=c.register.event.triggerAll("setContent",this.el.value);var b=this.options.toolbar.split(" ");for(var a in b)microEditor.plugins.list[b[a]]?microEditor.plugins.list[b[a]].call(this):""!==b[a].trim()&&console.error("No Plugin Called : "+b[a]);this.register.event.disableAllButtons(!0),this.register.event.dropdownCloseListener()}},this.create={button:function(b,d){var e=document.createElement("div"),f=document.createElement("button");if(e.classList.add("button-container"),e.appendChild(f),e.addEventListener("mousedown",function(a){a.preventDefault()}),d){var g=document.createTextNode(b);f.appendChild(g)}else d=b;return f.addEventListener("click",function(a){a.preventDefault(),d&&d.call(c,f,a),c.register.update.triggerAll(),c.register.event.dropdownCloseAll(),f.dropdownContent&&f.dropdownContent.classList.toggle("show")}),f.icon=function(a){return f.innerHTML="<i class='"+a+"'></i>",f},f.update=function(a){return c.register.update.define(f,a),f},f.highlight=function(a,b){return this.update(function(d){var e=b?c.register.cmd.value(a,b)==b:c.register.cmd.state(a);e?d.classList.add("highlight"):d.classList.remove("highlight")}),f},f.parent=function(){return e},f.dropdownContent=null,f.dropdownCallback=null,f.dropdown=function(a){return f.classList.add("dropbtn"),f.dropdownContent=document.createElement("div"),f.dropdownContent.classList.add("dropdown-content"),e.appendChild(f.dropdownContent),f.dropdownCallback=a,f},f.menu=function(b,d){var e=document.createElement("a");return e.innerHTML=b,e.addEventListener("click",function(e){e.preventDefault(),f.dropdownCallback&&f.dropdownCallback.call(c,d||b,f),"function"==typeof a&&f.dropdownCallback.call(c,f)}),f.dropdownContent.appendChild(e),f},f.modal=function(a){a.call(c,f)},f.tooltip=function(a){return f.setAttribute("tip",a),f},c.append(e,!0),f},input:function(a,b){var d=document.createElement("input");return d.type="string"==typeof a?a:"text",b||(b=a),d.addEventListener("change",function(a){b.call(c,a)}),d.icon=function(a){d.innerHTML="<i class='"+a+"'></i>"},c.append(d,!0),d},editor:function(){var a=document.createElement("div");if(a.classList.add("editor"),a.contentEditable=!0,c.register.threadEvent(a,"click keyup focus mouseup",function(){c.register.update.triggerAll()}),c.register.threadEvent(a,"blur keyup paste input focus change input",function(){c.el.value=c.register.event.triggerAll("getContent",this.innerHTML)},c.options.debounce||10),c.el.addEventListener("change",function(){a.innerHTML=c.register.event.triggerAll("setContent",c.el.value)}),c.options.debugMode||(c.el.style.display="none"),a.addEventListener("paste",function(a){if((c.options.preventPaste||c.options.pasteAsPlain)&&a.preventDefault(),c.options.pasteAsPlain){if(c.options.preventPaste)return;var b=(a.originalEvent||a).clipboardData.getData("text/plain")||prompt("Paste something..");c.register.action("insertText",b)}}),c.options.expandable||(a.style.height=c.options.height||100,a.style.overflow="auto"),c.options.showOnFocus){var b=!1,d=!1;c.container.classList.add("onfocus"),c.container.addEventListener("mouseover",function(){c.container.classList.add("focused"),d=!0}),c.container.addEventListener("mouseout",function(){b||c.container.classList.remove("focused"),d=!1}),a.addEventListener("focus",function(a){b||(b=!0,c.container.classList.add("focused"))}),a.addEventListener("mouseover",function(a){b||c.container.classList.add("focused")}),a.addEventListener("blur",function(a){b=!1,d||c.container.classList.remove("focused")}),a.addEventListener("mouseout",function(a){b||d||c.container.classList.remove("focused")})}return a.addEventListener("focus",function(a){c.register.event.disableAllButtons(!1)}),a.addEventListener("blur",function(a){c.register.event.disableAllButtons(!0)}),a.render=function(){c.append(a)},c.editor=a,a}},this.register={action:function(a,b){if("h1"==a||"h2"==a||"h3"==a||"h4"==a||"h5"==a||"h6"==a||"p"==a||"blockquote"==a||"pre"==a||"div"==a||"code"==a)document.execCommand("formatBlock",!1,a);else if("forecolor"==a||"backcolor"==a)document.execCommand(a,!1,b);else if("print"==a)this.doPrint();else if("createlink"==a||"insertimage"==a){var c=prompt("Enter the link here: ","http://");document.execCommand(a,!1,c)}else document.execCommand(a,!1,b)},cmd:{state:function(a){return document.queryCommandState(a)},value:function(a){return document.queryCommandValue(a)}},threadTimer:{},threadTime:100,threadEvent:function(a,b,d,e){var b=b.split(" ");for(var f in b)a.addEventListener(b[f],function(){clearTimeout(c.register.threadTimer[b]),c.register.threadTimer[b]=setTimeout(function(){d.call(a,b[f])},e||c.register.threadTime)})},doPrint:function(){var a=window.open("","_blank","width=450,height=470,left=400,top=100,menubar=yes,toolbar=no,location=no,scrollbars=yes");a.document.open(),a.document.write('<!doctype html><html><head><title>Print</title></head><body onload="print();">'+c.editor.innerHTML+"</body></html>"),a.document.close()},toolbar:function(a){c.options.extended.toolbar||(c.options.toolbar+=" "+a)},update:{list:[],define:function(a,b){this.list.push([a,b])},triggerAll:function(){for(var a in this.list)this.list[a][1].call(c,this.list[a][0])}},event:{dropdownCloseListener:function(){var a=this;window.onclick=function(b){b.target.matches(".dropbtn")||b.target.matches("i")||a.dropdownCloseAll()}},dropdownCloseAll:function(){var a,b=document.getElementsByClassName("dropdown-content");for(a=0;a<b.length;a++){var c=b[a];c.classList.contains("show")&&c.classList.remove("show")}},disableAllButtons:function(a){var b,d=document.querySelectorAll(".microEditor-idx"+c.idx+" .button-container>button");for(b=0;b<d.length;b++){var e=d[b];e.disabled=a}},list:{getContent:[],setContent:[]},triggerAll:function(a,b){if(!this.list[a])return b;for(var d in this.list[a])b=this.list[a][d].call(c,b);return b},on:function(a,b){this.list[a]||(this.list[a]=[]),this.list[a].push(b)}},script:function(a,b){var d=document.createElement("script");d.src=a,document.head.appendChild(d),b&&(d.onload=function(){b.call(c,this)})}},this.prepare=function(){this.container=document.createElement("div"),this.container.classList.add("microEditor"),this.container.classList.add("microEditor-idx"+this.idx),this.toolbar=document.createElement("div"),this.toolbar.classList.add("toolbar"),this.toolbar.classList.add(this.options.position);var a=this.getIndex();this.container.appendChild(this.toolbar),this.el.parentNode.insertBefore(this.container,this.el.parentNode.childNodes[a])},this.append=function(a,b){b?this.toolbar.appendChild(a):"top"==this.options.position?this.container.appendChild(a):this.container.insertBefore(a,this.toolbar)},this.getIndex=function(){for(var a=0,b=this.el;b=b.previousSibling;)++a;return a},this.init(),this};microEditor.plugins={init:{},list:{},register:function(a,b,c){this.list[a]=b,c&&(this.init[a]=c)}},microEditor.plugins.register("blockquote",function(){this.create.button(function(){this.register.action("blockquote")}).icon("fa fa-quote-left").tooltip("BlockQuote")}),microEditor.plugins.register("bold",function(){this.create.button(function(){this.register.action("bold")}).icon("fa fa-bold").highlight("bold").tooltip("Bold")}),microEditor.plugins.register("createlink",function(){this.create.button(function(){this.register.action("createlink")}).icon("fa fa-link").tooltip("Create Link")}),microEditor.plugins.register("fontName",function(){this.create.button().icon("fa fa-font").dropdown(function(a){this.register.action("fontName",a)}).tooltip("Font Name").menu("Tahoma").menu("Arial").menu("Comic Sans MS").menu("Courier New").menu("Impact").menu("Times New Roman").menu("Trebuchet MS").menu("Verdana").menu("Symbol").menu("Helvetica").menu("Monospace")},function(){this.register.toolbar("fontName")}),microEditor.plugins.register("fontSize",function(){this.create.button().icon("fa fa-text-height").dropdown(function(a){this.register.action("fontSize",a)}).tooltip("Font Size").menu(1).menu(2).menu(3).menu(4).menu(5).menu(6).menu(7)},function(){this.register.toolbar("fontSize")}),microEditor.plugins.register("format",function(){this.create.button().icon("fa fa-paragraph").dropdown(function(a){this.register.action(a)}).tooltip("Format").menu("DIV","div").menu("P","p").menu("H1","h1").menu("H2","h2").menu("H3","h3").menu("H4","h4").menu("H5","h5").menu("H6","h6")},function(){this.register.toolbar("format")}),microEditor.plugins.register("indent",function(){this.create.button(function(){this.register.action("indent")}).icon("fa fa-indent").highlight("indent").tooltip("Indent")}),microEditor.plugins.register("insertimage",function(){this.create.button(function(){this.register.action("insertimage")}).icon("fa fa-image").tooltip("Insert Image")}),microEditor.plugins.register("insertOrderedList",function(){this.create.button(function(){this.register.action("insertOrderedList")}).icon("fa fa-list-ol").highlight("insertorderedlist").tooltip("Insert Ordered List")}),microEditor.plugins.register("insertUnorderedList",function(){this.create.button(function(){this.register.action("insertUnorderedList")}).icon("fa fa-list-ul").highlight("insertunorderedlist").tooltip("Insert Unordered List")}),microEditor.plugins.register("italic",function(){this.create.button(function(){this.register.action("italic")}).icon("fa fa-italic").highlight("italic").tooltip("Italic")}),microEditor.plugins.register("justifyCenter",function(){this.create.button(function(){this.register.action("justifyCenter")}).icon("fa fa-align-center").highlight("justifycenter").tooltip("Justify Center")}),microEditor.plugins.register("justifyFull",function(){this.create.button(function(){this.register.action("justifyFull")}).icon("fa fa-align-justify").highlight("justifyfull").tooltip("Justify Full")}),microEditor.plugins.register("justifyLeft",function(){this.create.button(function(){this.register.action("justifyLeft")}).icon("fa fa-align-left").highlight("justifyleft").tooltip("Justify Left")}),microEditor.plugins.register("justifyRight",function(){this.create.button(function(){this.register.action("justifyRight")}).icon("fa fa-align-right").highlight("justifyright").tooltip("Justify Right")}),microEditor.plugins.register("outdent",function(){this.create.button(function(){this.register.action("outdent")}).icon("fa fa-outdent").highlight("outdent").tooltip("Outdent")}),microEditor.plugins.register("plainmode",function(){this.create.button(function(){console.log(this.options.pasteAsPlain),this.options.pasteAsPlain=!this.options.pasteAsPlain}).icon("fa fa-file-text").update(function(a){this.options.pasteAsPlain?a.classList.add("highlight"):a.classList.remove("highlight")}).tooltip("toogle Paste Plain Mode")},function(){this.register.toolbar("plainmode")}),microEditor.plugins.register("print",function(){this.create.button(function(){this.register.action("print")}).icon("fa fa-print").tooltip("Print")}),microEditor.plugins.register("redo",function(){this.create.button(function(){this.register.action("redo")}).icon("fa fa-repeat").tooltip("Redo")}),microEditor.plugins.register("removeFormat",function(){this.create.button(function(){this.register.action("removeFormat")}).icon("fa fa-eraser").tooltip("Remove Format")}),microEditor.plugins.register("strikeThrough",function(){this.create.button(function(){this.register.action("strikeThrough")}).icon("fa fa-strikethrough").highlight("strikethrough").tooltip("StrikeThrough")}),microEditor.plugins.register("subscript",function(){this.create.button(function(){this.register.action("subscript")}).icon("fa fa-subscript").highlight("subscript").tooltip("Subscript")}),microEditor.plugins.register("superscript",function(){this.create.button(function(){this.register.action("superscript")}).icon("fa fa-superscript").highlight("superscript").tooltip("Superscript")}),microEditor.plugins.register("underline",function(){this.create.button(function(){this.register.action("underline")}).icon("fa fa-underline").highlight("underline").tooltip("Underline")}),microEditor.plugins.register("undo",function(){this.create.button(function(){this.register.action("undo")}).icon("fa fa-undo").tooltip("Undo")}),microEditor.plugins.register("unlink",function(){this.create.button(function(){this.register.action("unlink")}).icon("fa fa-unlink").tooltip("Unlink")});